<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm position-relative">
  <div class="container">

    <!--
      3. Toggler now opens the offcanvas menu
    -->
    <button
      class="navbar-toggler navbar-toggler-custom"
      type="button"
      (click)="openOffcanvas(offcanvasMenu)"
      aria-controls="offcanvasMenu"
      aria-label="Toggle navigation"
    >
      <svg class="toggler-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
    </button>

    <!-- Logo (unchanged) -->
    <a class="navbar-brand mobile-logo-centered" routerLink="/">
      <img src="ni-experiences.png" alt="NI Experiences Logo" class="brand-logo">
    </a>

    <!--
      4. This is now the DESKTOP menu.
      - It's hidden on mobile (navbar-expand-lg)
      - We removed [ngbCollapse]
    -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <!-- Main Nav Links (Desktop) -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/destinations" routerLinkActive="active">Destinations</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/experiences" routerLinkActive="active">Experiences</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/hot-deals" routerLinkActive="active">
            ðŸ”¥ Hot Deals
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/about" routerLinkActive="active">About Us</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/contact" routerLinkActive="active">Contact Us</a>
        </li>
      </ul>

      <!-- Auth Nav Links (Desktop) -->
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 d-flex align-items-lg-center">
        @if (currentUser()) {
          <!-- Vendor Dashboard Dropdown -->
          @if (isVendor()) {
            <li class="nav-item" ngbDropdown>
              <a class="nav-link dropdown-toggle" role="button" ngbDropdownToggle id="vendorDropdown">
                My Dashboard
              </a>
              <div ngbDropdownMenu aria-labelledby="vendorDropdown">
                <a ngbDropdownItem routerLink="/dashboard/my-listings">My Listings</a>
                <a ngbDropdownItem routerLink="/dashboard/requests">Booking Requests</a>
                <a ngbDropdownItem routerLink="/dashboard/profile">Profile Settings</a>
              </div>
            </li>
          }
          <!-- Admin Links -->
          @if (isAdmin()) {
            <li class="nav-item" ngbDropdown>
              <a class="nav-link dropdown-toggle" role="button" ngbDropdownToggle id="adminDropdown">
                Admin
              </a>
              <div ngbDropdownMenu aria-labelledby="adminDropdown">
                <a ngbDropdownItem routerLink="/admin/vendors">Vendor Approvals</a>
                <a ngbDropdownItem routerLink="/admin/experiences">Experience Approvals</a>
              </div>
            </li>
          }
          <!-- Apply to Become Vendor (only for customers) -->
          @if (isCustomer()) {
            <li class="nav-item">
              <a class="nav-link" routerLink="/apply-vendor" routerLinkActive="active">Become a Vendor</a>
            </li>
          }
          <!-- User Dropdown -->
          <li class="nav-item" ngbDropdown>
            <a class="nav-link dropdown-toggle" role="button" ngbDropdownToggle id="userDropdown">
              Hi, {{ userFirstName() }}
            </a>
            <div ngbDropdownMenu aria-labelledby="userDropdown">
              <a ngbDropdownItem routerLink="/account/bookings">My Bookings</a>
              <a ngbDropdownItem routerLink="/account/profile">Profile</a>
              <div class="dropdown-divider"></div>
              <button ngbDropdownItem (click)="logout()">Logout</button>
            </div>
          </li>
        } @else {
          <!-- Auth Links -->
          <li class="nav-item">
            <a class="btn btn-outline-primary" routerLink="/register" routerLinkActive="active">Sign Up</a>
          </li>
          <li class="nav-item ms-lg-2 mt-2 mt-lg-0">
            <a class="btn btn-primary" routerLink="/login" routerLinkActive="active">Login</a>
          </li>
        }
      </ul>
    </div>
  </div>
</nav>

<!--
  5. Offcanvas Mobile Menu
  - This is the new slide-in menu.
  - It contains a copy of the nav links, styled for mobile.
-->
<ng-template #offcanvasMenu let-offcanvas>
  <div class="offcanvas-header offcanvas-custom">
    <h5 class="offcanvas-title text-white">Menu</h5>
    <button
      type="button"
      class="btn-close btn-close-white"
      (click)="offcanvas.dismiss('Cross click')"
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body offcanvas-custom">
    <!-- Mobile Main Nav -->
    <ul class="navbar-nav mb-4">
      <li class="nav-item">
        <a class="nav-link text-white" routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" (click)="offcanvas.dismiss()">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" routerLink="/destinations" routerLinkActive="active" (click)="offcanvas.dismiss()">Destinations</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" routerLink="/experiences" routerLinkActive="active" (click)="offcanvas.dismiss()">Experiences</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" routerLink="/hot-deals" routerLinkActive="active" (click)="offcanvas.dismiss()">
          ðŸ”¥ Hot Deals
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" routerLink="/about" routerLinkActive="active" (click)="offcanvas.dismiss()">About Us</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" routerLink="/contact" routerLinkActive="active" (click)="offcanvas.dismiss()">Contact Us</a>
      </li>
    </ul>

    <hr class="text-white-50">

    <!-- Mobile Auth Links -->
    <ul class="navbar-nav">
      @if (currentUser()) {
        <li class="nav-item mb-2">
          <span class="navbar-text text-white">Hi, {{ userFirstName() }}</span>
        </li>
        <!-- Vendor Dashboard Links -->
        @if (isVendor()) {
          <li class="nav-item">
            <a class="nav-link text-white" routerLink="/dashboard/my-listings" (click)="offcanvas.dismiss()">My Listings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" routerLink="/dashboard/requests" (click)="offcanvas.dismiss()">Booking Requests</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" routerLink="/dashboard/profile" (click)="offcanvas.dismiss()">Profile Settings</a>
          </li>
        }
        <!-- Admin Links -->
        @if (isAdmin()) {
          <li class="nav-item">
            <a class="nav-link text-white" routerLink="/admin/vendors" (click)="offcanvas.dismiss()">Vendor Approvals</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" routerLink="/admin/experiences" (click)="offcanvas.dismiss()">Experience Approvals</a>
          </li>
        }
        <!-- Apply to Become Vendor (only for customers) -->
        @if (isCustomer()) {
          <li class="nav-item">
            <a class="nav-link text-white" routerLink="/apply-vendor" (click)="offcanvas.dismiss()">Become a Vendor</a>
          </li>
        }
        <li class="nav-item">
          <a class="nav-link text-white" routerLink="/account/bookings" (click)="offcanvas.dismiss()">My Bookings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" routerLink="/account/profile" (click)="offcanvas.dismiss()">Profile</a>
        </li>
        <li class="nav-item">
          <button class="btn btn-link nav-link text-white px-0" (click)="logout(); offcanvas.dismiss();">Logout</button>
        </li>
      } @else {
        <li class="nav-item mb-2">
          <a class="btn btn-primary w-100" routerLink="/login" routerLinkActive="active" (click)="offcanvas.dismiss()">Login</a>
        </li>
        <li class="nav-item">
          <a class="btn btn-outline-primary w-100" routerLink="/register" routerLinkActive="active" (click)="offcanvas.dismiss()">Sign Up</a>
        </li>
      }
    </ul>
  </div>
</ng-template>
